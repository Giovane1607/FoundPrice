<div class="main-container" [class.dark-theme]="isDarkMode">
  <button class="dark-mode-toggle" (click)="toggleDarkMode()">{{ isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™' }}</button>
  
  <h1>Found<span>Price</span> ğŸ®</h1>
  
  <div class="search-bar">
    <input type="text" [(ngModel)]="query" (keyup.enter)="buscar()" placeholder="O que vocÃª procura?">
    <button (click)="buscar()" [disabled]="carregando">
      {{ carregando ? 'Buscando...' : 'Analisar' }}
    </button>
  </div>

  <table class="price-table" *ngIf="resultados.length > 0 && !carregando">
    <thead>
      <tr>
        <th>Status</th>
        <th>Loja</th>
        <th>Produto</th>
        <th>PreÃ§o</th>
        <th>AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of resultados">
        <td>
          <span [ngClass]="p.confiavel ? 'status-ok' : 'status-warning'">
            {{ p.confiavel ? 'âœ” Seguro' : 'âš  Risco' }}
          </span>
        </td>
        <td>{{ p.source }}</td>
        <td>{{ p.title }}</td>
        <td class="price-cell">{{ p.price | currency:'BRL' }}</td>
        <td class="acoes">
          <button class="btn-abrir" (click)="abrirLink(p.link)">Ir para Loja</button>
          <button class="btn-analise" (click)="analisarPrecos(p.title)">ğŸ“Š PreÃ§os</button>
          <button class="btn-vendas" (click)="compararMercado(p.title)">ğŸ¤ ComparaÃ§Ã£o</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="modal" *ngIf="exibirModal" (click)="exibirModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <span class="close" (click)="exibirModal = false">&times;</span>
      <h3>VariaÃ§Ã£o por Loja</h3>
      <div class="chart-container">
        <canvas id="graficoPrecos"></canvas>
      </div>
    </div>
  </div>

  <div class="modal" *ngIf="exibirModalVendas" (click)="exibirModalVendas = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <span class="close" (click)="exibirModalVendas = false">&times;</span>
      <h3>ğŸ›¡ï¸ Validador de Mercado</h3>
      <div class="stats-grid" *ngIf="dadosVendas">
        <div class="stat-card">
          <label>PreÃ§o MÃ©dio de Compra:</label>
          <p><strong>{{ dadosVendas.media_mercado | currency:'BRL' }}</strong></p>
        </div>
        <div class="stat-card highlight">
          <label>Menor PreÃ§o LegÃ­timo:</label>
          <p>{{ dadosVendas.menor_legitimo | currency:'BRL' }}</p>
        </div>
      </div>
      <div class="alerta-golpe" *ngIf="dadosVendas?.alerta_golpe">
        âš ï¸ <strong>Risco Detectado:</strong> Existem ofertas com preÃ§os irreais no mercado. 
        O "Menor PreÃ§o LegÃ­timo" acima ignora valores suspeitos de golpe.
      </div>
    </div>
  </div>
</div>